<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Gautrenez Analisia</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.15/_esm.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/lodash@4.17.21/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/_esm.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/_esm.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/_esm.js">
<link rel="icon" href="./_file/observable.1af93621.png" type="image/png" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile} from "./_observablehq/stdlib.js";

registerFile("./data/areas-metro-peninsula-clean.csv", {"name":"./data/areas-metro-peninsula-clean.csv","mimeType":"text/csv","path":"./_file/data/areas-metro-peninsula-clean.d01123a0.csv","lastModified":1720423625552});
registerFile("./data/stations-areas-metro-hand.csv", {"name":"./data/stations-areas-metro-hand.csv","mimeType":"text/csv","path":"./_file/data/stations-areas-metro-hand.110b1b67.csv","lastModified":1720390715304});
registerFile("./data/times-stations.csv", {"name":"./data/times-stations.csv","mimeType":"text/csv","path":"./_file/data/times-stations.b35639b4.csv","lastModified":1720391839628});

define({id: "a55b9b4a", inputs: ["FileAttachment","display","Inputs"], outputs: ["areasMetro"], body: async (FileAttachment,display,Inputs) => {
const areasMetro = await FileAttachment(
  "./data/areas-metro-peninsula-clean.csv"
).csv({ typed: true });
display(Inputs.table(areasMetro));
return {areasMetro};
}});

define({id: "bd8bb326", inputs: ["FileAttachment","display","Inputs"], outputs: ["stationsAreasMetro"], body: async (FileAttachment,display,Inputs) => {
const stationsAreasMetro = await FileAttachment(
  "./data/stations-areas-metro-hand.csv"
).csv({ typed: true });
display(Inputs.table(stationsAreasMetro));
return {stationsAreasMetro};
}});

define({id: "d632cc3d", inputs: ["FileAttachment","display","Inputs"], outputs: ["timesStations"], body: async (FileAttachment,display,Inputs) => {
const timesStations = await FileAttachment("./data/times-stations.csv").csv({
  typed: true,
});
display(Inputs.table(timesStations));
return {timesStations};
}});

define({id: "71424e21", inputs: ["areasMetro","timesStations","display"], outputs: ["Plot","format","areaInfo","_","getColorBySector","popFormat","formatMinutes","FROM_TO_SHOW","dataConsidered","chart"], body: async (areasMetro,timesStations,display) => {
const [Plot, {format}, {default: _}] = await Promise.all([import("./_npm/@observablehq/plot@0.6.15/_esm.js"), import("./_npm/d3-format@3.1.0/_esm.js"), import("./_npm/lodash@4.17.21/_esm.js")]);
const areaInfo = new Map(
  areasMetro.map(({ area, name, sec, pop2022 }) => [
    area,
    { name, sec, pop2022 },
  ])
);


function getColorBySector(sector) {
  switch (sector) {
    case "CN":
      return "#dce6a5";
    case "AT":
      return "#4285f4";
    case "CA":
      return "#34a853";
    case "MD":
      return "#fbbd05";
    case "SU":
      return "#ff6d01";
    case "PA":
      return "#131597";
    case "PR":
      return "#ab5fee";
    default:
      return "brown";
  }
}

const popFormat = format(".2s");
const formatMinutes = (totalMinutes) => {
  const hours = Math.floor(totalMinutes / 60);
  const minutes = totalMinutes % 60;

  let formattedTime = "";
  if (hours > 0) {
    formattedTime += `${hours} h `;
  }
  if (minutes > 0) {
    formattedTime += `${minutes} mins`;
  }
  return formattedTime.trim();
};

const FROM_TO_SHOW = ["B", "M", "BI", "VA", "SE", "VG", "CÑ"];
const dataConsidered = _.sortBy(
  timesStations
    .filter((d) => d.t <= 6 * 60)
    .filter(({ fromArea }) => FROM_TO_SHOW.includes(fromArea)),
  (d) => FROM_TO_SHOW.indexOf(d.fromArea)
);

const chart = Plot.plot({
  marginLeft: 90,
  insetLeft: 20,
  height: 450,
  width: 400,
  tip: true,
  fy: {
    grid: true,
    tickFormat: (d) => areaInfo.get(d).name,
  },
  marks: [
    Plot.dot(
      dataConsidered,
      Plot.dodgeY("middle", {
        fy: "fromArea",
        x: (d) => d.t / 60,
        r: (d) => areaInfo.get(d.toArea).pop2022,
        title: (d) => {
          const { name, pop2022 } = areaInfo.get(d.toArea);
          return `${areaInfo.get(d.fromArea)?.name} → ${name} (${popFormat(
            pop2022
          )} habitantes): ${formatMinutes(d.t)}`;
        },
        stroke: "white",
        fill: (d) =>
          d.t <= 3.75 * 60
            ? getColorBySector(areaInfo.get(d.toArea)?.sec)
            : "#e8e8e8",
      })
    ),
    Plot.text(
      dataConsidered,
      Plot.dodgeY("middle", {
        fy: "fromArea",
        filter: (d) => areaInfo.get(d.toArea).pop2022 > 5e5,
        x: (d) => d.t / 60,
        r: (d) => areaInfo.get(d.toArea).pop2022,
        text: "toArea",
        fill: "white",
        pointerEvents: "none",
        fontWeight: 700,
        fontSize: (d) => (areaInfo.get(d.toArea).pop2022 > 5e6 ? 20 : 6.5),
      })
    ),
    // Plot.tip(
    //   DATA_MA,
    //   Plot.pointerX({
    //     x: (d) => d.t / 60,
    //     title: (d) => {
    //       const { area:name, pop2022:pop } = areaInfo[d.area]
    //       return `${name} ${pop}`;
    //     },
    //   })
    // ),
  ],
});
display(chart);
return {Plot,format,areaInfo,_,getColorBySector,popFormat,formatMinutes,FROM_TO_SHOW,dataConsidered,chart};
}});

</script>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link observablehq-link-active"><a href="./">Gautrenez Analisia</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="./xversales/">Untitled</a></li>
  </ol>
</nav>
<script>{Object.assign(document.createElement("a"),{href:""}).password&&location.replace(location.href);const e=document.querySelector("#observablehq-sidebar"),t=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?t.checked=r==="true":t.indeterminate=!0;for(const o of document.querySelectorAll("#observablehq-sidebar summary")){const s=o.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${o.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<div class="hero">
  <h1>Gautrenez!</h1>
</div>
<h2 id="lotuneak" tabindex="-1"><a class="observablehq-header-anchor" href="#lotuneak">Lotuneak</a></h2>
<p>Kontutan hartu dira gune metropolitarrak <a href="https://es.wikipedia.org/wiki/Anexo:%C3%81reas_metropolitanas_de_Espa%C3%B1a#Listado_del_Ministerio_de_Vivienda_y_Agenda_Urbana" target="_blank" rel="noopener noreferrer">Espainiar Etxebizitza eta Hiri Agendarako Ministeritzaren zerrenda</a> baliatuz. Hemendik soilik lotune penintsularrak hartu dira.</p>
<p><a href="https://wikitable2csv.ggor.de/" target="_blank" rel="noopener noreferrer">wikitable2csv</a> tresna erabili da Wikipediako taulatik datuak ateratzeko, eta gero, eskuz, 1-2 hizkiko kodigo bat eta sektore kodigo zutabeak gehitu dira.</p>
<div class="observablehq observablehq--block"><!--:a55b9b4a:--></div>
<h2 id="bidai-denbora-minimoak" tabindex="-1"><a class="observablehq-header-anchor" href="#bidai-denbora-minimoak">Bidai denbora minimoak</a></h2>
<p>Hauek lortzeko lotune bakoitzean dauden geltokiak behar ditugu (oraingoz prozesu semi-automatikoa).</p>
<div class="observablehq observablehq--block"><!--:bd8bb326:--></div>
<p>Gero, denbora minimoak kalkulatuko ditugu eta lotuneen arteko geltokietan minimoa hartuko dugu.</p>
<div class="observablehq observablehq--block"><!--:d632cc3d:--></div>
<p>Eta hona hemen, azkenik, grafika:</p>
<div class="observablehq observablehq--block"><!--:71424e21:--></div>
<style>

.hero {
  display: flex;
  flex-direction: column;
  align-items: center;
  font-family: var(--sans-serif);
  margin: 2rem 0;
  text-wrap: balance;
  text-align: center;
}

.hero h1 {
  margin: 1rem 0;
  padding: 1rem 0;
  max-width: none;
  font-size: 14vw;
  font-weight: 900;
  line-height: 1;
  background: linear-gradient(30deg, var(--theme-foreground-focus), currentColor);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

@media (min-width: 640px) {
  .hero h1 {
    font-size: 90px;
  }
}

</style>
</main>
<footer id="observablehq-footer">
<nav><a rel="next" href="./xversales/"><span>Untitled</span></a></nav>
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2024-07-14T21:25:20">Jul 14, 2024</a>.</div>
</footer>
</div>
